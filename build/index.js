!function(e){var t={};function i(o){if(t[o])return t[o].exports;var n=t[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=t,i.d=function(e,t,o){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(i.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(o,n,function(t){return e[t]}.bind(null,n));return o},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t,i){"use strict";i.r(t),i(1),i(2)},function(e,t){window.wp=window.wp||{};var __=wp.i18n.__;!function(e){function t(){var t='<input type="search" style="width: 100%;" class="js-vistrom-taxonomy-search-field" placeholder="'.concat(__("Filter %s","vistorm-media"),'">');e(".cat-checklist").each((function(i,o){var n=e(o),r=t.replace("%s",n.find(".title").eq(i).text().toLowerCase());n.before(r)})),e(".js-vistrom-taxonomy-search-field").on("input",(function(t){var i=t.target.value,o=e(this).next(".cat-checklist").find("li");i.trim()?(o.hide(),o.filter((function(){return-1!==e(this).text().toLowerCase().indexOf(i.toLowerCase())})).show()):o.show()}))}document.querySelector("#posts-filter")&&"upload"===vistromMedia.screen&&document.querySelector("#posts-filter").addEventListener("submit",(function(i){var o=e("[name=action]").val(),n=e("[name=vistrom_media_bulk_edit]").val(),r=i.submitter;if("vistrom_media_edit"===o&&"doaction"===r.id){i.preventDefault();var a={action:"admin_vistrom_media_render_bulk_edit",post_ids:e('input[name="media[]"]:checked').map((function(e,t){return t.value})).get()},s=e("#posts-filter table").find("thead th:not(.hidden), thead td").length;e.post({url:window.vistromMedia.ajaxUrl,data:a,success:function(i){var o=i.data.html;e("#vistrom-media-bulk-edit-row").length?e("#vistrom-media-bulk-edit-row").replaceWith(o):e("#posts-filter").find("#the-list").prepend(o),e("#posts-filter").find("#vistrom-media-bulk-edit-row").find("td.colspanchange").prop("colspan",s),e(".js-vistrom-media-cancel-bulk-edit").click((function(){e("#vistrom-media-bulk-edit-row").remove()})),e(".js-vistrom-media-remove-from-bulk-edit").click((function(t){var i=t.target,o=i.dataset.product_id;e("#posts-filter").find('input[name="media[]"][value="'.concat(o,'"]:checked')).prop("checked",!1),i.parentElement.remove(),0===e(".js-vistrom-media-remove-from-bulk-edit").length&&e("#vistrom-media-bulk-edit-row").remove()})),t()},error:function(t){console.log(t),e("#vistrom-media-bulk-edit-row").remove()},beforeSend:function(){e("#posts-filter").find("#the-list").prepend('<tr class="loading"><td class="colspanchange" colspan="'.concat(s,'">').concat(__("Loading...","vistrom-media"),"</td></tr>"))},complete:function(){e("#posts-filter").find("#the-list").find(e("tr.loading")).remove()}})}else if("vistrom_media_edit"===o&&n){i.preventDefault();var l=e("#posts-filter").serializeArray();l.push({name:"action",value:"admin_vistrom_media_bulk_update"}),l.push({name:"_ajax_nonce",value:window.vistromMedia.nonces.bulkUpdate}),e.post({url:window.vistromMedia.ajaxUrl,data:l,success:function(t){var i=new URL(window.location.href);i.searchParams.set("vistrom_media_updated",e("#bulk-titles").children().length),window.location.href=i.href},error:function(e){console.log(e)}})}}));var i=wp.media.view.AttachmentFilters.extend({id:"vistrom-media-category-filter",createFilters:function(){var e={},t=this;_.each(this.options.taxonomy.terms,(function(i,o){e[o]={text:"".concat(i.name," (").concat(i.count,")"),props:{}},e[o].props[t.options.taxonomy.query_var]=i.slug})),e.all={text:__("All","vistrom-media")+" "+t.options.taxonomy.label,props:{},priority:10},e.all.props[t.options.taxonomy.query_var]="",this.filters=e}}),o=wp.media.view.Button,n=wp.media.view.Button.extend({initialize:function(){o.prototype.initialize.apply(this,arguments),this.controller.on("select:activate",this.show,this),this.controller.on("select:deactivate",this.hide,this),this.controller.on("selection:toggle",this.toggleDisabled,this),this.controller.on("select:activate",this.toggleDisabled,this)},toggleDisabled:function(){this.model.set("disabled",!this.controller.state().get("selection").length)},show:function(){this.$el.removeClass("hidden")},hide:function(){this.$el.addClass("hidden")},render:function(){return o.prototype.render.apply(this,arguments),this.controller.isModeActive("select")?this.$el.addClass("edit-selected-button"):this.$el.addClass("edit-selected-button hidden"),this.toggleDisabled(),this},click:function(){if(this.controller.state().get("selection").length){var i={action:"admin_vistrom_media_render_grid_bulk_edit",post_ids:this.controller.state().get("selection").map((function(e){return e.toJSON().id}))};e.post({url:window.vistromMedia.ajaxUrl,data:i,success:function(i){var o=i.data.html;e("body").append(o),document.querySelector("body").style.overflow="hidden",e(".vistrom-media-modal").on("click",".js-vistrom-media-modal-close",(function(e){e.preventDefault(),s()})),e(".js-vistrom-media-remove-from-bulk-edit").click((function(t){t.preventDefault(),t.stopPropagation(),t.target.parentElement.remove(),0===e(".js-vistrom-media-remove-from-bulk-edit").length&&s()})),e("body").on("click",(function(t){e(t.target).closest(".vistrom-media-modal-content").length||s()})),e("body").on("keydown",(function(e){"Escape"===e.key&&s()})),t(),e(".js-vistrom-bulk-edit-form").on("submit",(function(t){t.preventDefault();var i=e(this).serializeArray();i.push({name:"action",value:"admin_vistrom_media_bulk_update"}),i.push({name:"_ajax_nonce",value:window.vistromMedia.nonces.bulkUpdate}),e.post({url:window.vistromMedia.ajaxUrl,data:i,success:function(e){window.location.reload()},error:function(e){console.log(e)}})}))},error:function(e){console.log(e)}})}}}),r=wp.media.view.AttachmentsBrowser;wp.media.view.AttachmentsBrowser=wp.media.view.AttachmentsBrowser.extend({createToolbar:function(){var e=this;r.prototype.createToolbar.call(this),window.vistromMedia.mediaTaxonomies.forEach((function(t){e.toolbar.set("MediaLibrary"+t.name+"Filter",new i({controller:e.controller,model:e.collection.props,priority:-75,taxonomy:t}).render())})),this.controller.isModeActive("grid")&&this.toolbar.set("MediaLibraryBulkEdit",new n({style:"primary",text:__("Edit","vistrom-media"),controller:this.controller,priority:-80}).render())}});var a=wp.media.view.AttachmentCompat;function s(){e(".vistrom-media-modal").remove(),document.querySelector("body").style.overflow="initial"}wp.media.view.AttachmentCompat=wp.media.view.AttachmentCompat.extend({render:function(){return a.prototype.render.call(this),setTimeout((function(){t()}),0),this}}),wp.media.view.AttachmentCompat.prototype.save=function(e){var t={};e&&e.preventDefault(),_.each(this.$el.serializeArray(),(function(e){/\[\]$/.test(e.name)?(void 0===t[e.name]&&(t[e.name]=[]),t[e.name].push(e.value)):t[e.name]=e.value})),this.controller.trigger("attachment:compat:waiting",["waiting"]),this.model.saveCompat(t).always(_.bind(this.postSave,this))}}(jQuery)},function(e,t,i){}]);